<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        canvas {

            position: relative;
            top: 2em;
            left: 20%;

            box-shadow: .5em .5em 2em green;

        }


        span {

            font-size: large;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        div {
            margin: 5%;
            margin-bottom: 15%;
            width: fit-content;
            padding: 10px;

            border: 2px solid black;
            border-radius: 10px;

        }

        section {
            position: absolute;
            top: 0;
            margin: 5%;
        }
    </style>

</head>

<body>


    <canvas onclick="switchState(true)" id="canvas" width="1000" height="1000"></canvas>

    <section>




        <div>

            <span>Size: </span> <span id="sizeCounter">1</span>
            <br>
            <input type="range" min="1" max="1000" value="10" id="size">
        </div>

        <div>

            <span>Resolution: </span> <span id="resCounter">2</span>
            <br>
            <input type="range" min="2" max="1000" value="5" id="resolution">
        </div>
        <div>

            <span>Angles: </span> <span id="anglesCounter">1</span>
            <br>
            <input type="range" min="1" max="1000" value="1" id="angles">
        </div>

    </section>



    <script>
        // Dieser Code generiert erstmal die Augen
        //
        // Der Mund wird berechnet:
        //
        // Der S_Vector ist die Position an der gezeichnet wird
        // -> Der einheitsVector + der S_Vector ist die nächste Position
        //
        // posFace[0] ist der Startpunkt
        // posFace[1] ist der Mittelpunkt
        // posFace[2] ist der Endpunkt

        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let is_happy = true;

        class UI {
            ////////////////////// UI-Components ///////////////////////

            resSlider = document.getElementById('resolution');
            anglesSlider = document.getElementById('angles');
            sizeSlider = document.getElementById('size');



            size = 2;
            angles = 1;

            resolution = 100;

            //-------------------- UI-Components ---------------------//

            add(V_position, a) {
                ctx.fillRect(V_position.pos.x, V_position.pos.y, a, a);
            }
        }
        _UI = new UI();

        _UI.resSlider.oninput = function () {
            _UI.resolution = _UI.resSlider.value;
            document.getElementById('resCounter').innerHTML = _UI.resSlider.value;
            switchState(false);
        }
        _UI.sizeSlider.oninput = function () {
            _UI.size = _UI.sizeSlider.value;
            document.getElementById('sizeCounter').innerText = _UI.sizeSlider.value;
            switchState(false);

        }
        _UI.anglesSlider.oninput = function () {
            _UI.angles = _UI.anglesSlider.value;
            document.getElementById('anglesCounter').innerText = _UI.anglesSlider.value;
            switchState(false);
        }

        function cos(degree) {
            //return Math.fround(Math.cos(degree * Math.PI / 180));
            return Math.cos(degree * Math.PI / 180);
        }

        function sin(degree) {
            //return Math.fround(Math.sin(degree * Math.PI / 180));
            return Math.sin(degree * Math.PI / 180);
        }

        function betrag(num) {
            if (
                num < 0) {
                return -num;
            }
            return num;
        }
        //-------------------- Vector ---------------------// 
        class Vector {
            pos = {
                x: 0,
                y: 0 
                // z: 0 
            }; 
            constructor(x, y, z) 
            { this.pos.x=x; 
                this.pos.y=y; 
                // this.pos.z=z; 
            }
                addVector(_Vector = new Vector()) {
                    this.pos.x += _Vector.pos.x;
                    this.pos.y += _Vector.pos.y; 
                    // this.pos.z+= _Vector.pos.z;
                }
                subtractVector(_Vector = new Vector()) 
                {
                    this.pos.x -= _Vector.pos.x;
                    this.pos.y -= _Vector.pos.y; 
                    // this.pos.z +=_Vector.pos.z; 
                } 
                setVector(x, y, z) { 
                    this.pos.x=x; 
                    this.pos.y=y;
                    this.pos.z = z;
                }
                rotate(degrees, clockwise) {
                    let tmp_x;
                    let tmp_y;
                    if (clockwise) {
                        tmp_x = (cos(degrees) *
                            this.pos.x) + (sin(degrees) * this.pos.y);
                        tmp_y = -(sin(degrees) * this.pos.x) + (cos(degrees) * this.pos.y);
                        this.pos.x = Math.fround(tmp_x);
                        this.pos.y = Math.fround(tmp_y);
                    } else { //console.log("X: "+ this.pos.x);
                        tmp_x = ((cos(degrees) * this.pos.x) - (sin(degrees) * this.pos.y));
                        //console.log(" Y: "+ this.pos.y); 
                        tmp_y = ((sin(degrees) * this.pos.x) + (cos(degrees) * this.pos.y));


                        this.pos.x = Math.fround(tmp_x);
                        this.pos.y = Math.fround(tmp_y);
                        // console.log(" New X: "+ this.pos.x);
                        //console.log(" New Y: "+ this.pos.y);
                    }




                }
                copy(_Vector = new Vector()) {
                    this.pos.x = _Vector.pos.x;
                    this.pos.y = _Vector.pos.y;
                    // this.pos.z = _Vector.pos.z;
                }
                getLength() {
                    let length = Math.sqrt(
                        (
                            Math.pow(this.pos.x, 2) + Math.pow(this.pos.y, 2) + Math.pow(this.pos.z, 2)
                        )
                    );
                    return length;
                }
                crop(fac) {
                    this.pos.x /= fac;
                    this.pos.y /= fac;
                    // this.pos.z /= fac;
                }
                multiply(fac) {
                    this.pos.x *= fac;
                    this.pos.y *= fac;
                    // this.pos.z *= fac;
                }
                unitVector() {
                    this._unitVector = new Vector(this.pos.x / this.getLength(), this.pos.y / this
                .getLength()); // this.pos.z / this.getLength());
                    return this._unitVectorVector;
                }
            }
            ////////////////////// Vector ///////////////////////



            //-------------------- Line ---------------------//
            class Line {

                drawLine(_start, _end, debug) {
                    // Start is a coordinate and end is a vector


                    // COPY of start and end to prevent override
                    if (debug == 5) {
                        console.log(" S:", _start);
                        console.log("E: ", _end);
                    }

                    this.start = new Vector();
                    this.start.copy(_start);

                    this.end = new Vector(0, 0);
                    this.end.copy(_end);


                    // Vektor wird auf den Abstand der pixel getrimmt
                    this.end.crop(_UI.resolution);

                    // Startpunkt zeichnen 
                    _UI.add(this.start, _UI.size);
                    //  console.log(" Start: ",_start);  

                    // Für anfang bis Ende, pro schritt 1 Pixel
                    // TODO resolution einstellen  
                    for (let n = 0; n < _UI.resolution; n++) {
                        this.start.addVector(this.end);
                        _UI.add(this.start, _UI.size);
                    }
                    // console.log(" END: ",this.start ); 
                    this.tmp = new Vector;
                    this.tmp.copy(this.start);
                    return this.tmp;
                }

                // drawAngle(start = new Vector(), end = new Vector() , left)
                // {


                //     ////////////// Vektoren //////////// 

                //     // Vector von Start nach Ende
                //     this.V_line = new Vector(end.pos.x - start.pos.x, end.pos.y - start.pos.y);
                //     this.corner = new Vector();
                //     this.corner.copy(start); 

                //         this.alpha = 90 / (2**(_UI.angles-1));
                //         this.beta = (180-this.alpha) /2; 
                //         this.gamma = 180-(2*this.beta);

                //         //this.a = sin(this.alpha/2) * 2 * _Vector.pos.x;

                //         console.log(" Angles: "+_UI.angles); 
                //         console.log(" Alpha: "+this.alpha);  
                //         console.log(" Beta: "+this.beta);
                //         console.log(" gamma: "+this.gamma);


                //     this.drawVector = new Vector();

                //     // Vector der die Kanten bestimmt 
                //     this.angleVector = new Vector(0,0);
                //         //---> Die Line wird kopiert 
                //         this.angleVector.copy(this.V_line); 
                //         this.angleVector.rotate(45);

                //             //EinheitsVector
                //             this.angleVector.crop(this.angleVector.getLength());
                //                 this.angleVector.multiply(((sin(this.alpha)*betrag(this.V_line.pos.x))*2)); 
                //             console.log(this.angleVector.getLength()) 
                //             //---> Auf den Winkel gedreht 
                //             //let angle = (45-(90/(2**_UI.angles)));
                //            // this.angleVector.rotate(angle, !is_happy );
                //                 //---> Geschrumpft auf Größe   
                //                     //this.angleVector.multiply(this.base(this.V_line) / this.angleVector.getLength());
                //                     //this.angleVector.crop(2); 







                //     // 22.5 ->2
                //     // 20 ->  3
                //     // 15.25 -> 4 
                //     // 12.75 -> 5 




                //     //angle = _UI.angles == 2 ? 22.5 : _UI.angles == 3 ? 20 : _UI.angles == 4 ? 15.25 : angle;
                //     // this.L = new Vector();
                //     // this.L.copy(this.start);
                //     // this.L.pos.x += this.V_line.pos.x;
                //     // this.V = new Vector(this.V_line.pos.x, 0); 
                //     // this.V.rotate(45, true);

                //     this.L = new Vector(0, 100);  
                //     this.L.copy(start);
                //     this.L.pos.x = this.L.pos.x + 200;
                //     this.V = new Vector(-100, 100);  
                //     this.drawLine(this.L, this.V);

                //     this.drawLine(start, this.V_line);




                //     //this.angleVector.rotate(this.gamma,is_happy);
                //     for(let i = 1; i <= _UI.angles && 1 == 1; i++){ 
                //         if(i % 2 == 0) { 
                //             this.angleVector.rotate(this.gamma,is_happy);   
                //         }       

                //         this.drawVector.copy(this.angleVector);     
                //             this.drawLine(this.corner, this.drawVector); 
                //                 this.angleVector.rotate(this.gamma,is_happy);     
                //     } 







                // } 

                drawCircle(position, _radius, chunks, rotation, debug) {

                    //if(!debug) 
                    {
                        // Middle point of the Circle as Vector
                        this.middle = new Vector(position.x, position.y);

                        // TODO: Vom Mittelpunkt gerade nach links, so lange wie der Radius ist 
                        this.V_radius = new Vector(-_radius, 0);



                        // TODO 1: Grundseite
                        //Zum Kopieren
                        this.origin = new Vector();
                        this.origin.copy(this.V_radius);
                        this.origin.multiply(-1);

                        this.first = new Vector();
                        this.first.copy(this.middle);
                        this.first.addVector(this.V_radius);

                        this.second = new Vector(0, 0);
                        this.second.copy(this.origin);
                        console.log(this.origin)


                        this.lastV = new Vector(0, 0);
                        this.lastV.copy(this.V_radius);



                        //this.second.copy(this.middle); 


                        // TODO: Nächster chunk 
                        for (let n = 0; n < chunks; n++) {
                            this.origin.copy(this.V_radius);
                            this.origin.multiply(-1);
                            this.first.copy(this.middle);
                            this.first.addVector(this.V_radius);
                            this.second.copy(this.origin);
                            console.log(this.origin)
                            this.lastV.copy(this.V_radius);
                            this.drawLine(this.middle, this.V_radius);

                            for (let i = 0; i < _UI.angles; i++) {

                                // TODO: radius dreht sich <angles> +1 mal
                                this.V_radius.rotate((rotation ? -1 : 1) * (90 / _UI.angles));
                                this.drawLine(this.middle, this.V_radius, true);
                                this.lastV.copy(this.V_radius);

                                // TODO: Grundseite wird mitgezeichnet 
                                // Hier Startpunkt der Grundseite
                                if (i >= 1) {
                                    this.second.subtractVector(this.lastV);
                                    this.second.multiply(-1);
                                } else {
                                    this.second.addVector(this.lastV);
                                }




                                this.drawLine(this.first, this.second);

                                this.first.copy(this.middle);
                                this.first.addVector(this.V_radius);



                                // TODO 1: Zweiten Punkt Berechnen
                                this.lastV.copy(this.V_radius);
                                this.second.copy(this.lastV);



                                this.lastV.copy(this.V_radius);
                            }
                        }


                    }
                }
            }
            ////////////////////// Line ///////////////////////



            //----------------------THE Smiley-----------------------//
            class Smiley {

                constructor(posEyes, posFace) {
                    this.posFace = posFace;
                    this.posEyes = posEyes;
                }

                posEyes = [{
                        x: 0,
                        y: 0
                    },
                    {
                        x: 0,
                        y: 0
                    }
                ];

                posFace = {

                    x: 0,
                    y: 0

                };

                setEyes(posEyes) {
                    this.posEyes = posEyes;
                }
                setFace(posFace) {
                    this.posFace = posFace;
                }

                draw_Eyes() {
                    // New Line Object
                    this.eyeLine = new Line();

                    // Left eye (full circle) 
                    this.eyeLine.drawCircle(this.posEyes[0], 30, 4, true, true);

                    // Right eye (full circle)
                    this.eyeLine.drawCircle(this.posEyes[1], 30, 4, true, true);

                }
                drawMouth() {
                    const MOUTH_SIZE = 200;
                    this.mouthLine = new Line();
                    this.posFace.y = is_happy ? 250 : 250 + MOUTH_SIZE;

                    // draw Mouth (halv circe)
                    this.mouthLine.drawCircle(this.posFace, 200, 2, is_happy);
                }

                draw_smiley() {

                    ////// Clear Canvas //////
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = 'black';
                    //--- Clear Canvas ----//

                    // Draw Smiley, consists of Eyes and Mouth
                    this.draw_Eyes();
                    this.drawMouth();
                }

            }
            ////////////////////// THE Smiley ///////////////////////




            //---------------------- Setup -----------------------//


            posEyes = [{
                    x: 250,
                    y: 100
                },
                {
                    x: 750,
                    y: 100
                }
            ];

            posFace = {

                x: 500,
                y: 900

            };


            // Start 
            switchState(false);

            // Switch from Happy to Sad
            function switchState(change_State) {

                if (change_State) {
                    is_happy = !is_happy;
                    canvas.style.boxShadow = is_happy ? " .5em .5em 2em green" : ".5em .5em 2em red";
                }
                Smileyy = new
                Smiley(posEyes, posFace);
                Smileyy.draw_smiley();
            } ////////////////////// SETUP ///////////////////////
    </script>


</body>

</html>